<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>添加魂兽 - 斗罗大陆OL</title>
<link rel="icon" href="favicon.ico" type="image/ico">
<meta name="keywords" content="斗罗大陆OL,群大型网络RPG文字游戏">
<meta name="description" content="斗罗大陆OL是一个基于Java/Python等语言写的高拓展性群娱乐游戏。">
<meta name="author" content="yinqi">
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/materialdesignicons.min.css" rel="stylesheet">
<link href="css/style.min.css" rel="stylesheet">
</head>
  
<body>
<div class="lyear-layout-web">
  <div class="lyear-layout-container">
    <div id="header" th:include="common/header :: common_header(${title},${page},${page_tab})"></div>
    <!--End 头部信息-->
    
    <!--页面主要内容-->
    <main class="lyear-layout-content">

      <div class="container-fluid">
        <div class="row">
          <!-- .col-sm-6 -->
          
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header bg-cyan">
                <h4>添加魂兽</h4>
              </div>
              <div class="card-body">
                <div class="tab-content">
                  <div class="tab-pane active">
                    
                    <form action="#!" method="post" name="edit-form" class="edit-form">
                      <div class="form-group">
                        <label for="hsname">魂兽名</label>
                        <input class="form-control" type="text" id="hsname" name="hsname" value="" placeholder="请输入魂兽名">
                      </div>
                      <div class="form-group">
                        <label for="age">年份</label>
                        <input class="form-control" type="number" id="age" name="age" value="" placeholder="请输入魂兽年份" >
                      </div>
                      <div class="form-group">
                        <label for="map">出没地图</label>
                        <input class="form-control" type="text" id="map" name="map" value="" placeholder="请输入要出没的地图名">
                      </div>
                      <div class="form-group">
                        <label for="exp">经验</label>
                        <input class="form-control" type="number" id="exp" name="exp" value="" placeholder="请输入击杀经验值">
                      </div>
                      <div class="form-group">
                        <label for="hp">生命</label>
                        <input class="form-control" type="number" id="hp" name="hp" value="" placeholder="请输入魂兽生命">
                      </div>
                      <div class="form-group">
                        <label for="pow">力量</label>
                        <input class="form-control" type="number" id="pow" name="pow" value="" placeholder="请输入魂兽力量">
                      </div>
                      <div class="form-group">
                        <label for="speed">速度</label>
                        <input class="form-control" type="number" id="speed" name="speed" value="" placeholder="请输入魂兽速度">
                      </div>
                      <div class="form-group">
                        <label for="def">防御</label>
                        <input class="form-control" type="number" id="def" name="def" value="" placeholder="请输入魂兽防御力">
                      </div>
                      <div class="form-group">
                        <label for="mp">魂力</label>
                        <input class="form-control" type="number" id="mp" name="mp" value="" placeholder="请输入魂兽魂力值">
                      </div>
                      <div class="form-group">
                        <label for="dodge">闪避</label>
                        <input class="form-control" type="number" id="dodge" name="dodge" value="" placeholder="请输入魂兽闪避">
                      </div>
                      <div class="form-group">
                        <label for="ct">暴击率</label>
                        <input class="form-control" type="number" id="ct" name="ct" value="" placeholder="请输入魂兽暴击率">
                        <small class="help-block">暴击率说明：<code>百分比，超过100与100的概率一样</code></small>
                      </div>
                      <div class="form-group">
                        <label for="ctp">爆伤</label>
                        <input class="form-control" type="number" id="ctp" name="ctp" value="" placeholder="请输入魂兽暴击伤害">
                      </div>
                      <br>
                      <h3>魂兽魂技</h3>
                      <div class="example-right pull-right">
                        <button type="button" class="btn btn-primary" id="add-skill">追加</button>
                      </div>
                      <br>
                      <div class="row gx-3 gy-2 align-items-center" id="new-group">
                        <div class="col-auto">
                            <label class="visually-hidden" for="skill">魂技</label>
                            <input type="text" class="form-control" id="skill" name="skill" placeholder="魂技">
                        </div>
                        <div class="col-auto">
                            <label class="visually-hidden" for="ap">掉落概率</label>
                            <input type="number" class="form-control" id="ap" name="ap" placeholder="魂环掉落概率">
                        </div>
                        <div class="col-auto">
                            <label class="visually-hidden" for="rp">释放概率</label>
                            <input type="number" class="form-control" id="rp" name="rp" placeholder="魂环释放概率">
                        </div>
                      </div>
                    </form>
                    
                  </div>
                </div>
              </div>
              <footer class="card-footer">
              
                <div class="example-right pull-right">
                  <button class="btn btn-primary" type="reset" id="example-five">取消</button>
                  <button class="btn btn-danger" type="submit" onclick="ajaxAddHunshou()">添加</button>
                </div>
              </footer>
            </div>
          </div>
          <!-- .col-sm-6 --> 
        </div>
        <!-- .row --> 
        <!-- End Cards with Actions -->
        
      </div>
      
    </main>
    <!--End 页面主要内容-->
  </div>
</div>
<script>
  const addSkillButton = document.getElementById('add-skill');
  const newGroupContainer = document.getElementById('new-group');

  addSkillButton.addEventListener('click', () => {
    // Create new form elements
    const newGroup = document.createElement('div');
    newGroup.classList.add('row', 'gx-3', 'gy-2', 'align-items-center');

    const newSkillGroup = document.createElement('div');
    newSkillGroup.classList.add('col-auto');
    const newApGroup = document.createElement('div');
    newApGroup.classList.add('col-auto');
    const newRpGroup = document.createElement('div');
    newRpGroup.classList.add('col-auto');


    const skillInput = document.createElement('input');
    skillInput.type = 'text';
    skillInput.classList.add('form-control');
    skillInput.id = 'skill';
    skillInput.placeholder = '魂技';

    const apInput = document.createElement('input');
    apInput.type = 'number';
    apInput.classList.add('form-control');
    apInput.id = 'ap';
    apInput.placeholder = '魂环掉落概率';

    const rpInput = document.createElement('input');
    rpInput.type = 'number';
    rpInput.classList.add('form-control');
    rpInput.id = 'rp';
    rpInput.placeholder = '魂环释放概率';

    // Add form elements to the container
    newSkillGroup.appendChild(skillInput);
    newApGroup.appendChild(apInput);
    newRpGroup.appendChild(rpInput);
    newGroup.appendChild(newSkillGroup);
    newGroup.appendChild(newApGroup);
    newGroup.appendChild(newRpGroup);
    newGroupContainer.appendChild(newGroup);
  });
</script>
<script type="text/javascript">
  // Ajax提交表单
  function ajaxAddHunshou() {
    const hsname = $('input[name="hsname"]').val();
    const age = $('input[name="age"]').val();
    const map = $('input[name="map"]').val();
    const exp = $('input[name="exp"]').val();
    const hp = $('input[name="hp"]').val();
    const pow = $('input[name="pow"]').val();
    const speed = $('input[name="speed"]').val();
    const def = $('input[name="def"]').val();
    const mp = $('input[name="mp"]').val();
    const dodge = $('input[name="dodge"]').val();
    const ct = $('input[name="ct"]').val();
    const ctp = $('input[name="ctp"]').val();
    // 遍历动态增加的表单，将它们的值存入数组中
    const skillData = [];

    $('input[name="skill"]').each(function() {
      const skill = $(this).val();
      const ap = $(this).closest('.row').find('input[name="ap"]').val();
      const rp = $(this).closest('.row').find('input[name="rp"]').val();
      skillData.push({ skill, ap, rp });
    });
    // 发送ajax请求
    $.ajax({
      type: "POST",
      url: "/api/hunshou/add",
      data: JSON.stringify({
        "魂兽名": hsname,
        "年份": age,
        "经验": exp,
        "出没地图": map,
        "hsData": {"力量": pow, "暴伤": ctp, "生命": hp, "速度": speed, "闪避": dodge, "防御": def, "魂力": mp, "暴击率": ct},
        "skillData": skillData
      }),
      contentType : "application/json",
      dataType: "json",
      async:false
    });
  }
</script>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/perfect-scrollbar.min.js"></script>
<script type="text/javascript" src="js/main.min.js"></script>
</body>
</html>